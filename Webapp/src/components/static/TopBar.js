//static
import { useRouter } from 'next/router';
import Link from 'next/link';
import { SearchBar } from '../inputs';
import { useState, useEffect } from 'react';
import * as Routing from '@/lib/routing';
import SideMenu from './SideMenu';

import kinojilogo from '@/assets/logo.svg';
import minimlogo from '@/assets/logo-minimized.svg';

import { BurgerMenu, Panel } from './TopBar.children';
import { AnimatePresence } from 'framer-motion';



export default () => {

  const [active, setActive] = useState(true);
  const [minimized, setMinimized] = useState(false);
  const [open, setOpen] = useState(false);
  const router = useRouter();
  const location = router.pathname;

  useEffect(() => {
    const onMatchMedia = (e) => setMinimized(e.matches)
    const mediaQuery = window.matchMedia('(max-width:800px)');
    mediaQuery.addEventListener('change', onMatchMedia);

    onMatchMedia(mediaQuery);

    return () => mediaQuery.removeEventListener('change', onMatchMedia);
  }, []);

  useEffect(() => {

    const onScroll = () => {
      if (open) { return; }
      if (window.pageYOffset > (window.innerHeight * 1 / 3)) { setActive(true); }
      else { setActive(false); }
    }

    if (Routing.isSettings(location)) { setActive(true); }
    else if (Routing.isHomepage(location)) { setActive(false); document.addEventListener('scroll', onScroll); }
    else {
      setActive(true);
      document.removeEventListener('scroll', onScroll);
    }

    setOpen(false);

    return () => {
      document.removeEventListener('scroll', onScroll);
    }

  }, [location]);

  useEffect(() => { setActive(true) }, [open]);

  return (
    <nav id="topMenu" className={`${active ? '' : 'inactive'} ${Routing.isSettings(location) ? 'transparent' : ''} ${open ? 'open' : ''}`}>
      <div id='kinoIco'>
        <Link href='/'>
          <picture>
            <source srcSet={minimlogo.src} media="(max-width: 800px)" />
            <img src={kinojilogo.src} />
          </picture>
        </Link>
        <Link href='/movies'>movies</Link>
        <Link href='/collections'>collections</Link>
      </div>
      <div id='toolsBar'>
        <SearchBar />

        <Link href='/worldmap'>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8.43198 7.93766C9.01664 4.15883 10.3956 1.50562 12.0004 1.50562C13.6052 1.50562 14.9841 4.15883 15.5688 7.93766H8.43198ZM15.8712 12C15.8712 12.9394 15.8228 13.8407 15.7381 14.7082H8.26667C8.18199 13.8407 8.13361 12.9394 8.13361 12C8.13361 11.0606 8.18199 10.1592 8.26667 9.29177H15.7381C15.8228 10.1592 15.8712 11.0606 15.8712 12ZM2.77898 7.93766C3.93216 5.0644 6.26675 2.8428 9.1497 1.9457C8.16586 3.37598 7.48847 5.52987 7.13365 7.93766H2.77898ZM14.8551 1.9457C17.734 2.8428 20.0727 5.0644 21.2218 7.93766H16.8671C16.5163 5.52987 15.839 3.37598 14.8551 1.9457V1.9457ZM2.34754 9.29177H6.97236C6.88769 10.1804 6.8393 11.0902 6.8393 12C6.8393 12.9098 6.88769 13.8196 6.97236 14.7082H2.35158C2.12981 13.8407 2.00482 12.9394 2.00482 12C2.00482 11.0606 2.12981 10.1592 2.34754 9.29177ZM17.1615 12C17.1615 11.0902 17.1131 10.1804 17.0284 9.29177H21.6532C21.871 10.1592 22 11.0606 22 12C22 12.9394 21.871 13.8407 21.6532 14.7082H17.0325C17.1131 13.8196 17.1615 12.9098 17.1615 12V12ZM15.5688 16.0623C14.9841 19.8412 13.6052 22.4944 12.0004 22.4944C10.3956 22.4944 9.01664 19.8412 8.43198 16.0623H15.5688ZM9.14567 22.0543C6.26675 21.1572 3.92813 18.9356 2.77495 16.0623H7.12962C7.48444 18.4701 8.16183 20.624 9.14567 22.0543ZM21.2218 16.0623C20.0686 18.9356 17.734 21.1572 14.8511 22.0543C15.8349 20.624 16.5123 18.4701 16.8671 16.0623H21.2218V16.0623Z" />
          </svg>

        </Link>

        <Link href='/glossary'>
          <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5.8 4.45454C5.8 4.12905 5.92643 3.81689 6.15147 3.58673C6.37652 3.35657 6.68174 3.22727 7 3.22727H19.8C20.1183 3.22727 20.4235 3.35657 20.6485 3.58673C20.8736 3.81689 21 4.12905 21 4.45454C21 4.78003 20.8736 5.09219 20.6485 5.32235C20.4235 5.55251 20.1183 5.68181 19.8 5.68181H7C6.68174 5.68181 6.37652 5.55251 6.15147 5.32235C5.92643 5.09219 5.8 4.78003 5.8 4.45454ZM19.8 9.77272H7.0006C6.68234 9.77272 6.37712 9.90202 6.15207 10.1322C5.92703 10.3623 5.8006 10.6745 5.8006 11C5.8006 11.3255 5.92703 11.6376 6.15207 11.8678C6.37712 12.098 6.68234 12.2273 7.0006 12.2273H19.8C20.1183 12.2273 20.4235 12.098 20.6485 11.8678C20.8736 11.6376 21 11.3255 21 11C21 10.6745 20.8736 10.3623 20.6485 10.1322C20.4235 9.90202 20.1183 9.77272 19.8 9.77272ZM19.8 16.3182H7.0006C6.68234 16.3182 6.37712 16.4475 6.15207 16.6776C5.92703 16.9078 5.8006 17.22 5.8006 17.5454C5.8006 17.8709 5.92703 18.1831 6.15207 18.4133C6.37712 18.6434 6.68234 18.7727 7.0006 18.7727H19.8C20.1183 18.7727 20.4235 18.6434 20.6485 18.4133C20.8736 18.1831 21 17.8709 21 17.5454C21 17.22 20.8736 16.9078 20.6485 16.6776C20.4235 16.4475 20.1183 16.3182 19.8 16.3182ZM2.6 9.36363C2.28355 9.36363 1.97421 9.4596 1.71109 9.63941C1.44797 9.81921 1.24289 10.0748 1.12179 10.3738C1.00069 10.6728 0.969008 11.0018 1.03074 11.3192C1.09248 11.6367 1.24487 11.9282 1.46863 12.1571C1.69239 12.3859 1.97749 12.5418 2.28786 12.6049C2.59823 12.6681 2.91993 12.6356 3.21229 12.5118C3.50466 12.3879 3.75454 12.1782 3.93035 11.9091C4.10616 11.64 4.2 11.3236 4.2 11C4.2 10.566 4.03143 10.1498 3.73137 9.84291C3.43131 9.53603 3.02435 9.36363 2.6 9.36363ZM2.6 2.81818C2.28355 2.81818 1.97421 2.91415 1.71109 3.09395C1.44797 3.27376 1.24289 3.52932 1.12179 3.82833C1.00069 4.12734 0.969008 4.45635 1.03074 4.77378C1.09248 5.0912 1.24487 5.38277 1.46863 5.61162C1.69239 5.84047 1.97749 5.99632 2.28786 6.05946C2.59823 6.1226 2.91993 6.09019 3.21229 5.96634C3.50466 5.84249 3.75454 5.63275 3.93035 5.36365C4.10616 5.09456 4.2 4.77818 4.2 4.45454C4.2 4.02055 4.03143 3.60433 3.73137 3.29746C3.43131 2.99058 3.02435 2.81818 2.6 2.81818ZM2.6 15.9091C2.28355 15.9091 1.97421 16.0051 1.71109 16.1849C1.44797 16.3647 1.24289 16.6202 1.12179 16.9192C1.00069 17.2182 0.969008 17.5473 1.03074 17.8647C1.09248 18.1821 1.24487 18.4737 1.46863 18.7025C1.69239 18.9314 1.97749 19.0872 2.28786 19.1504C2.59823 19.2135 2.91993 19.1811 3.21229 19.0572C3.50466 18.9334 3.75454 18.7237 3.93035 18.4546C4.10616 18.1855 4.2 17.8691 4.2 17.5454C4.2 17.1115 4.03143 16.6952 3.73137 16.3884C3.43131 16.0815 3.02435 15.9091 2.6 15.9091Z"  />
          </svg>

        </Link>

        <Link href='/shots'>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.00007 11.9992C0.998203 13.3939 1.26287 14.7761 1.77983 16.0715L11.5209 6.33038L7.2634 2.07117C5.39127 2.96935 3.81045 4.37739 2.70253 6.13355C1.59462 7.88972 1.00455 9.92277 1.00007 11.9992V11.9992Z"  />
            <path d="M2.07111 16.7367C3.2741 19.2559 5.38947 21.2238 7.98889 22.2419C10.5883 23.2601 13.4775 23.2523 16.0714 22.2203L6.33029 12.4792L2.07111 16.7367Z"  />
            <path d="M23 11.9992C23.0016 10.6051 22.737 9.22348 22.2202 7.92865L12.4791 17.6697L16.7366 21.9273C18.609 21.0294 20.1901 19.6214 21.298 17.8652C22.406 16.109 22.9959 14.0757 23 11.9992V11.9992Z"  />
            <path d="M11.9992 1.00005C10.605 0.997606 9.22326 1.26232 7.92865 1.77983L17.6697 11.5209L21.9289 7.26173C21.0302 5.38979 19.6218 3.80923 17.8654 2.70163C16.1089 1.59402 14.0757 1.00425 11.9992 1.00005V1.00005Z"  />
          </svg>

        </Link>


      </div>
      {minimized ? <BurgerMenu onClick={e => setOpen(e)} /> :
        <div className='secondary-menu'>
          <Link href='/about'>about</Link>
          <Link href='/contact'>contact</Link>
        </div>}
      <AnimatePresence mode='wait'>
        {open && <Panel />}
      </AnimatePresence>
    </nav>
  );

}
